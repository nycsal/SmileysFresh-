<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smiley‚Äôs Fresh Catch Game</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; width: 100%;
      background: #f7ffe0;
      font-family: 'Comic Sans MS', 'Comic Sans', cursive, sans-serif;
      touch-action: none;
      user-select: none;
      overflow: hidden;
    }
    #gameCanvas {
      background: linear-gradient(to bottom, #e0ffd6 0%, #fffbe0 100%);
      display: block;
      margin: 0 auto;
      touch-action: none;
      border: 4px solid #a5e35b;
      border-radius: 24px;
      box-shadow: 0 8px 32px #b8e99477;
    }
    #overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(255,255,255,0.92);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      font-size: 2rem;
      color: #4caf50;
      text-align: center;
    }
    #startBtn, #restartBtn {
      margin-top: 32px;
      padding: 14px 36px;
      border: none;
      background: #ffeb3b;
      color: #388e3c;
      font-size: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px #b8e99477;
      cursor: pointer;
      font-family: inherit;
      transition: background 0.2s;
    }
    #startBtn:hover, #restartBtn:hover {
      background: #cddc39;
    }
    @media (max-width: 600px) {
      #gameCanvas { width: 100vw !important; height: 70vw !important; }
      #overlay { font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="480" height="720"></canvas>
  <div id="overlay" style="display:flex;">
    <h1>üçì Smiley‚Äôs Fresh Catch üçå</h1>
    <p>
      Move your basket to catch <b>three of the same</b> fruit, veggie, or smoothie.<br>
      <span style="color:#f44336;">If you catch a different one as the third, you lose your basket!</span><br>
      <br>
      <b>Score 1000 points to advance to the next level!</b><br>
      <br>
      <b>Touch and drag</b> the basket to move.<br>
      <br>
      <span style="font-size:1.3em;">Ready to play?</span>
    </p>
    <button id="startBtn">Start Game</button>
  </div>
  <script>
    // --- GAME CONSTANTS ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let W = canvas.width, H = canvas.height;

    // For responsive design
    function resizeCanvas() {
      let ww = window.innerWidth, wh = window.innerHeight;
      let scale = Math.min(ww / 480, wh / 720);
      canvas.style.width = (480*scale) + 'px';
      canvas.style.height = (720*scale) + 'px';
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // --- GAME DATA ---
    const ITEMS = [
      {name: "Strawberry", emoji: "üçì"},
      {name: "Banana", emoji: "üçå"},
      {name: "Carrot", emoji: "ü•ï"},
      {name: "Broccoli", emoji: "ü•¶"},
      {name: "Apple", emoji: "üçè"},
      {name: "Smoothie", emoji: "ü•§"}
    ];
    const GOLDEN_SMOOTHIE = {name: "Golden Smoothie", emoji: "‚ú®ü•§‚ú®", golden: true};

    const LEVELS = [
      {goal: 1000, speed: 2, dropRate: 60},
      {goal: 1500, speed: 2.5, dropRate: 50},
      {goal: 1750, speed: 3, dropRate: 40},
      {goal: 2000, speed: 3.5, dropRate: 30}
    ];
    const LEVEL_TIME = 40; // seconds

    // --- GAME STATE ---
    let gameState = 'start'; // start, playing, between, over
    let level = 0;
    let score = 0;
    let timer = LEVEL_TIME;
    let basket = [];
    let falling = [];
    let dropTick = 0;
    let basketX = W/2, basketWidth = 90, basketHeight = 44;
    let basketTargetX = basketX;
    let touchOffset = 0;
    let redXTimer = 0;
    let confetti = [];
    let message = "";

    // --- UI ELEMENTS ---
    const overlay = document.getElementById('overlay');
    const startBtn = document.getElementById('startBtn');
    let restartBtn = null;

    // --- GAME LOOP ---
    function resetGame() {
      level = 0; score = 0; timer = LEVEL_TIME;
      basket = []; falling = []; dropTick = 0;
      basketX = W/2; basketTargetX = basketX;
      redXTimer = 0; confetti = [];
      message = "";
    }

    function startGame() {
      gameState = 'playing';
      resetGame();
      overlay.style.display = 'none';
      requestAnimationFrame(gameLoop);
    }

    function nextLevel() {
      level++;
      if (level >= LEVELS.length) {
        endGame(true);
      } else {
        timer = LEVEL_TIME;
        basket = [];
        falling = [];
        dropTick = 0;
        message = "";
        gameState = 'between';
        setTimeout(() => {
          gameState = 'playing';
          requestAnimationFrame(gameLoop);
        }, 2500);
        showPromo();
      }
    }

    function endGame(won=false) {
      gameState = 'over';
      overlay.innerHTML = `
        <h1>${won ? "üéâ You Win! üéâ" : "Game Over"}</h1>
        <p>Your Score: <b>${score}</b></p>
        <p>${won ? "You are a Smiley‚Äôs Fresh Champion!" : "Try again to beat your high score!"}</p>
        <p style="font-size:1.3em;">Don‚Äôt forget to get a smoothie at Smiley‚Äôs Fresh!<br>üçìü•¶üçåü•§</p>
        <button id="restartBtn">Play Again</button>
      `;
      overlay.style.display = 'flex';
      restartBtn = document.getElementById('restartBtn');
      restartBtn.onclick = () => {
        overlay.style.display = 'none';
        startGame();
      };
    }

    function showPromo() {
      overlay.innerHTML = `
        <h2>Level ${level+1} Complete!</h2>
        <p>Your Score: <b>${score}</b></p>
        <div style="font-size:1.2em;">
          Don‚Äôt forget to get a smoothie at Smiley‚Äôs Fresh!<br>
          <span style="color:#ff9800;">üçìü•¶üçåü•§</span><br>
          <b>Today‚Äôs Deal:</b> 2-for-1 Smoothies!
        </div>
      `;
      overlay.style.display = 'flex';
      setTimeout(() => { overlay.style.display = 'none'; }, 2000);
    }

    function gameLoop() {
      if (gameState !== 'playing') return;
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    function update() {
      // Timer
      if (timer > 0) {
        timer -= 1/60;
        if (timer <= 0) {
          timer = 0;
          if (score >= LEVELS[level].goal) {
            nextLevel();
          } else {
            endGame();
          }
        }
      }
      // Move basket
      basketX += (basketTargetX - basketX)*0.25;
      if (basketX < basketWidth/2) basketX = basketWidth/2;
      if (basketX > W-basketWidth/2) basketX = W-basketWidth/2;
      // Drop items
      dropTick++;
      if (dropTick >= LEVELS[level].dropRate) {
        dropTick = 0;
        let item;
        if (Math.random() < 0.06) {
          item = {...GOLDEN_SMOOTHIE};
        } else {
          item = {...ITEMS[Math.floor(Math.random()*ITEMS.length)]};
        }
        let x = Math.random()*(W-44)+22;
        falling.push({item, x, y: -30, speed: LEVELS[level].speed + Math.random()*1.2});
      }
      // Move falling items
      for (let i=falling.length-1; i>=0; i--) {
        let f = falling[i];
        f.y += f.speed;
        // Check catch
        if (f.y > H-90 && Math.abs(f.x-basketX) < basketWidth/2+16) {
          // Caught!
          if (f.item.golden) {
            score += 200;
            confettiBurst();
            message = "‚ú® Golden Smoothie! +200 ‚ú®";
          } else {
            basket.push(f.item.name);
            if (basket.length === 3) {
              if (basket.every(n => n === basket[0])) {
                score += 100;
                confettiBurst();
                message = "Nice! +100";
                basket = [];
              } else {
                redXTimer = 30;
                message = "Oops! Basket emptied!";
                basket = [];
              }
            }
          }
          falling.splice(i,1);
        } else if (f.y > H+40) {
          // Missed
          falling.splice(i,1);
        }
      }
      // Red X timer
      if (redXTimer > 0) redXTimer--;
      // Confetti
      for (let i=confetti.length-1; i>=0; i--) {
        let c = confetti[i];
        c.y += c.vy; c.x += c.vx; c.vy += 0.1;
        c.life--;
        if (c.life <= 0) confetti.splice(i,1);
      }
    }

    function confettiBurst() {
      for (let i=0;i<18;i++) {
        confetti.push({
          x: basketX,
          y: H-70,
          vx: Math.cos(i/3)*Math.random()*3,
          vy: -Math.abs(Math.sin(i/3)*Math.random()*3)-2,
          color: `hsl(${Math.random()*360},90%,60%)`,
          life: 24+Math.random()*12
        });
      }
    }

    function draw() {
      // Background
      ctx.clearRect(0,0,W,H);
      // Scoreboard
      ctx.fillStyle = "#388e3c";
      ctx.font = "bold 26px Comic Sans MS";
      ctx.textAlign = "left";
      ctx.fillText(`Score: ${score}`, 18, 38);
      ctx.textAlign = "center";
      ctx.fillText(`Level ${level+1}`, W/2, 38);
      ctx.textAlign = "right";
      ctx.fillText(`Time: ${Math.ceil(timer)}`, W-18, 38);

      // Draw falling items
      for (let f of falling) {
        ctx.font = f.item.golden ? "32px Comic Sans MS" : "32px Comic Sans MS";
        ctx.textAlign = "center";
        ctx.globalAlpha = 1;
        ctx.fillText(f.item.emoji, f.x, f.y);
      }
      ctx.globalAlpha = 1;

      // Basket
      ctx.save();
      ctx.translate(basketX, H-60);
      // Basket base
      ctx.fillStyle = "#ffe082";
      ctx.beginPath();
      ctx.ellipse(0,0,basketWidth/2,basketHeight/2,0,0,Math.PI*2);
      ctx.fill();
      ctx.strokeStyle = "#c8b560";
      ctx.lineWidth = 4;
      ctx.stroke();
      // Basket smile
      ctx.beginPath();
      ctx.arc(0,6,22,Math.PI*0.15,Math.PI*0.85,false);
      ctx.lineWidth = 3;
      ctx.strokeStyle = "#4caf50";
      ctx.stroke();
      // Basket handles
      ctx.beginPath();
      ctx.arc(-basketWidth/2+12,-8,10,Math.PI*0.5,Math.PI*1.5,false);
      ctx.arc(basketWidth/2-12,-8,10,Math.PI*1.5,Math.PI*0.5,false);
      ctx.lineWidth = 2;
      ctx.strokeStyle = "#c8b560";
      ctx.stroke();
      // Items in basket
      for (let i=0;i<basket.length;i++) {
        let idx = ITEMS.findIndex(it=>it.name===basket[i]);
        let emoji = idx>=0 ? ITEMS[idx].emoji : "‚ùì";
        ctx.font = "28px Comic Sans MS";
        ctx.fillText(emoji, -24+24*i, -10);
      }
      ctx.restore();

      // Red X
      if (redXTimer>0) {
        ctx.save();
        ctx.globalAlpha = redXTimer/30;
        ctx.strokeStyle = "#f44336";
        ctx.lineWidth = 12;
        ctx.beginPath();
        ctx.moveTo(W/2-40,H/2-40);
        ctx.lineTo(W/2+40,H/2+40);
        ctx.moveTo(W/2+40,H/2-40);
        ctx.lineTo(W/2-40,H/2+40);
        ctx.stroke();
        ctx.restore();
      }

      // Confetti
      for (let c of confetti) {
        ctx.save();
        ctx.globalAlpha = Math.max(0,c.life/36);
        ctx.fillStyle = c.color;
        ctx.beginPath();
        ctx.arc(c.x,c.y,4,0,Math.PI*2);
        ctx.fill();
        ctx.restore();
      }

      // Message
      if (message) {
        ctx.font = "bold 28px Comic Sans MS";
        ctx.fillStyle = "#ff9800";
        ctx.textAlign = "center";
        ctx.fillText(message, W/2, H/2-80);
        if (Math.random()<0.02) message = ""; // Fade out
      }
    }

    // --- TOUCH CONTROLS ---
    let dragging = false;
    function getTouchX(e) {
      let rect = canvas.getBoundingClientRect();
      let x = e.touches ? e.touches[0].clientX : e.clientX;
      let scale = W / rect.width;
      return (x - rect.left) * scale;
    }
    canvas.addEventListener('touchstart', function(e){
      let x = getTouchX(e);
      if (Math.abs(x-basketX) < basketWidth) {
        dragging = true;
        touchOffset = x-basketX;
      }
    });
    canvas.addEventListener('touchmove', function(e){
      if (dragging) {
        let x = getTouchX(e);
        basketTargetX = x-touchOffset;
      }
      e.preventDefault();
    }, {passive:false});
    canvas.addEventListener('touchend', function(e){
      dragging = false;
    });

    // Mouse support for desktop
    canvas.addEventListener('mousedown', function(e){
      let x = getTouchX(e);
      if (Math.abs(x-basketX) < basketWidth) {
        dragging = true;
        touchOffset = x-basketX;
      }
    });
    canvas.addEventListener('mousemove', function(e){
      if (dragging) {
        let x = getTouchX(e);
        basketTargetX = x-touchOffset;
      }
    });
    canvas.addEventListener('mouseup', function(e){
      dragging = false;
    });

    // --- START GAME ---
    startBtn.onclick = startGame;

    // --- Prevent scrolling on mobile ---
    document.body.addEventListener('touchmove', function(e){
      if (gameState === 'playing') e.preventDefault();
    }, {passive:false});

    // --- Responsive resize on load ---
    window.addEventListener('load', resizeCanvas);

    // --- Draw initial screen ---
    draw();
  </script>
</body>
</html>
